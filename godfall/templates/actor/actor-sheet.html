<form class="{{cssClass}}" autocomplete="off">
  <header class="sheet-header">
    <img class="profile-img" src="{{actor.img}}" data-edit="img" title="{{actor.name}}" />
    <div class="header-fields">
      <h1 class="charname"><input name="name" type="text" value="{{actor.name}}" placeholder="Character Name" /></h1>
      <div class="grid grid-3col">
        <div class="resource">
          <label for="system.hp.value" class="resource-label">{{localize "GODFALL.HP"}}</label>
          <input type="text" name="system.hp.value" value="{{system.hp.value}}" data-dtype="Number" />
          <span>/</span>
          <input type="text" name="system.hp.max" value="{{system.hp.max}}" data-dtype="Number" />
        </div>
        <div class="resource">
          <label for="system.wp.value" class="resource-label">{{localize "GODFALL.WP"}}</label>
          <input type="text" name="system.wp.value" value="{{system.wp.value}}" data-dtype="Number" />
          <span>/</span>
          <input type="text" name="system.wp.max" value="{{system.wp.max}}" data-dtype="Number" />
        </div>
        <div class="resource">
          <label for="system.dv.value" class="resource-label">{{localize "GODFALL.DV"}}</label>
          <input type="text" name="system.dv.value" value="{{system.dv.value}}" data-dtype="Number" readonly />
        </div>
      </div>
    </div>
  </header>

  <nav class="sheet-tabs tabs" data-group="primary">
    <a class="item" data-tab="main">Main</a>
    <a class="item" data-tab="combat">{{localize "GODFALL.Combat"}}</a>
    <a class="item" data-tab="inventory">{{localize "GODFALL.Inventory"}}</a>
    <a class="item" data-tab="spells">{{localize "GODFALL.Spells"}}</a>
    <a class="item" data-tab="talents">{{localize "GODFALL.Talents"}}</a>
  </nav>

  <section class="sheet-body">
    <div class="tab" data-group="primary" data-tab="main">
      <!-- Horizontal Attributes -->
      <div class="attributes-horizontal">
        {{#each system.attributes as |attr key|}}
        <div class="attribute-compact rollable" data-roll="1d20+{{attr.mod}}" data-label="{{attr.label}}">
          <div class="attribute-name">{{localize attr.label}}</div>
          <input type="text" name="system.attributes.{{key}}.value" value="{{attr.value}}" data-dtype="Number" />
          <div class="attribute-mod">{{#if (gt attr.mod 0)}}+{{attr.mod}}{{else}}{{attr.mod}}{{/if}}</div>
        </div>
        {{/each}}
      </div>
      
      <!-- Custom Weapon Skills Section -->
      <div class="custom-skills-section">
        <div class="section-header">
          <h3>Weapon Skills</h3>
          <button type="button" class="add-skill-btn" data-skill-type="weapon" title="Add Weapon Skill">
            <i class="fas fa-plus"></i>
          </button>
        </div>
        <div class="custom-skills-list" data-skill-type="weapon">
          {{#each weaponSkillsArray as |skill|}}
          <div class="custom-skill" data-skill-id="{{@index}}">
            <input type="text" name="system.custom_weapon_skills.{{@index}}.name" value="{{skill.name}}" placeholder="Skill Name" class="skill-name-input" />
            <input type="text" name="system.custom_weapon_skills.{{@index}}.value" value="{{skill.value}}" data-dtype="Number" class="skill-value-input" />
            <button type="button" class="remove-skill-btn" data-skill-type="weapon" data-skill-id="{{@index}}" title="Remove Skill">
              <i class="fas fa-trash"></i>
            </button>
          </div>
          {{/each}}
        </div>
      </div>
      
      <!-- Custom Backgrounds Section -->
      <div class="custom-skills-section">
        <div class="section-header">
          <h3>Backgrounds</h3>
          <button type="button" class="add-skill-btn" data-skill-type="background" title="Add Background">
            <i class="fas fa-plus"></i>
          </button>
        </div>
        <div class="custom-skills-list" data-skill-type="background">
          {{#each backgroundsArray as |background|}}
          <div class="custom-skill" data-skill-id="{{@index}}">
            <input type="text" name="system.custom_backgrounds.{{@index}}.name" value="{{background.name}}" placeholder="Background Name" class="skill-name-input" />
            <input type="text" name="system.custom_backgrounds.{{@index}}.value" value="{{background.value}}" data-dtype="Number" class="skill-value-input" />
            <button type="button" class="remove-skill-btn" data-skill-type="background" data-skill-id="{{@index}}" title="Remove Background">
              <i class="fas fa-trash"></i>
            </button>
          </div>
          {{/each}}
        </div>
      </div>
    </div>

    <div class="tab" data-group="primary" data-tab="combat">
      <div class="items-list">
        <div class="item-list-header flexrow">
          <div class="item-name">Weapon</div>
          <div class="item-controls"><a class="item-control item-create" title="Create weapon" data-type="weapon"><i class="fas fa-plus"></i> Add</a></div>
        </div>
        {{#each combat.weapons as |item id|}}
        <div class="item weapon-item flexrow" data-item-id="{{item._id}}">
          <div class="item-image"><img src="{{item.img}}" title="{{item.name}}" width="24" height="24"/></div>
          <div class="item-main">
            <h4 class="item-name weapon-roll" data-item-id="{{item._id}}">{{item.name}}</h4>
            <div class="weapon-properties">{{item.system.properties}}</div>
          </div>
          <div class="weapon-toggles">
            {{#if item.system.versatile}}
            <label class="versatile-toggle" title="Use two-handed">
              <input type="checkbox" name="items.{{item._id}}.system.two_handed" {{#if item.system.two_handed}}checked{{/if}} />
              2H
            </label>
            {{/if}}
            <label class="equipped-toggle" title="Equipped">
              <input type="checkbox" name="items.{{item._id}}.system.equipped" {{#if item.system.equipped}}checked{{/if}} />
              <i class="fas fa-check"></i>
            </label>
          </div>
          <div class="item-controls">
            <a class="item-control item-edit" title="Edit Item"><i class="fas fa-edit"></i></a>
            <a class="item-control item-delete" title="Delete Item"><i class="fas fa-trash"></i></a>
          </div>
        </div>
        {{/each}}
      </div>
      
      <div class="items-list">
        <div class="item-list-header flexrow">
          <div class="item-name">Armor</div>
          <div class="item-controls"><a class="item-control item-create" title="Create armor" data-type="armor"><i class="fas fa-plus"></i> Add</a></div>
        </div>
        {{#each combat.armor as |item id|}}
        <div class="item armor-item flexrow" data-item-id="{{item._id}}">
          <div class="item-image"><img src="{{item.img}}" title="{{item.name}}" width="24" height="24"/></div>
          <div class="item-main">
            <h4 class="item-name item-chat">{{item.name}}</h4>
            <div class="armor-stats">DR {{item.system.dr}}, Evasion {{item.system.evasionPenalty}}</div>
          </div>
          <div class="armor-toggles">
            <label class="equipped-toggle" title="Equipped">
              <input type="checkbox" name="items.{{item._id}}.system.equipped" {{#if item.system.equipped}}checked{{/if}} />
              <i class="fas fa-check"></i>
            </label>
          </div>
          <div class="item-controls">
            <a class="item-control item-edit" title="Edit Item"><i class="fas fa-edit"></i></a>
            <a class="item-control item-delete" title="Delete Item"><i class="fas fa-trash"></i></a>
          </div>
        </div>
        {{/each}}
      </div>
    </div>

    <div class="tab" data-group="primary" data-tab="inventory">
      <div class="items-list">
        <div class="item-list-header flexrow">
          <div class="item-name">Item</div>
          <div class="item-controls"><a class="item-control item-create" title="Create item" data-type="item"><i class="fas fa-plus"></i> Add</a></div>
        </div>
        {{#each inventory as |item id|}}
        <div class="item flexrow" data-item-id="{{item._id}}">
          <div class="item-image"><img src="{{item.img}}" title="{{item.name}}" width="24" height="24"/></div>
          <h4 class="item-name item-chat">{{item.name}}</h4>
          <div class="item-quantity">{{item.system.quantity}}</div>
          <div class="item-controls">
            <a class="item-control item-edit" title="Edit Item"><i class="fas fa-edit"></i></a>
            <a class="item-control item-delete" title="Delete Item"><i class="fas fa-trash"></i></a>
          </div>
        </div>
        {{/each}}
      </div>
    </div>

    <div class="tab" data-group="primary" data-tab="spells">
      <div class="items-list">
        <div class="item-list-header flexrow">
          <div class="item-name">Spell</div>
          <div class="item-controls"><a class="item-control item-create" title="Create spell" data-type="spell"><i class="fas fa-plus"></i> Add</a></div>
        </div>
        {{#each spells as |item id|}}
        <div class="item flexrow" data-item-id="{{item._id}}">
          <div class="item-image"><img src="{{item.img}}" title="{{item.name}}" width="24" height="24"/></div>
          <h4 class="item-name item-chat">{{item.name}}</h4>
          <div class="spell-cost">{{item.system.cost}} WP</div>
          <div class="item-controls">
            <a class="item-control item-edit" title="Edit Item"><i class="fas fa-edit"></i></a>
            <a class="item-control item-delete" title="Delete Item"><i class="fas fa-trash"></i></a>
          </div>
        </div>
        {{/each}}
      </div>
    </div>

    <div class="tab" data-group="primary" data-tab="talents">
      <div class="items-list">
        <div class="item-list-header flexrow">
          <div class="item-name">Talent</div>
          <div class="item-controls"><a class="item-control item-create" title="Create talent" data-type="talent"><i class="fas fa-plus"></i> Add</a></div>
        </div>
        {{#each talents as |item id|}}
        <div class="item flexrow" data-item-id="{{item._id}}">
          <div class="item-image"><img src="{{item.img}}" title="{{item.name}}" width="24" height="24"/></div>
          <h4 class="item-name item-chat">{{item.name}}</h4>
          <div class="item-controls">
            <a class="item-control item-edit" title="Edit Item"><i class="fas fa-edit"></i></a>
            <a class="item-control item-delete" title="Delete Item"><i class="fas fa-trash"></i></a>
          </div>
        </div>
        {{/each}}
      </div>
    </div>
  </section>
</form>
